<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Avoid The Zones</title>
<style>
  body {
    margin: 0; background: #001f2f; color: #00ffff; font-family: 'Courier New', monospace;
    display: flex; justify-content: center; align-items: center; height: 100vh;
    overflow: hidden;
    flex-direction: column;
  }
  canvas {
    background: #001f2f;
    box-shadow: 0 0 30px #00ffff;
    border-radius: 10px;
  }
  #startScreen {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: #00ffff;
    text-align: center;
    font-family: monospace;
  }
  button {
    background: #00ffff;
    border: none;
    padding: 10px 20px;
    margin-top: 15px;
    font-size: 18px;
    font-weight: bold;
    color: #001f2f;
    cursor: pointer;
    border-radius: 5px;
    box-shadow: 0 0 10px #00ffff;
  }
  button:hover {
    background: #00ccbb;
  }
</style>
</head>
<body>
  <div id="startScreen">
    <h1>Krahcore Runner Game - Avoid The Zones</h1>
    <p>Règles du jeu :</p>
    <p>Évite la zone rouge qui se déplace horizontalement.</p>
    <p>Utilise les flèches gauche et droite pour déplacer ton cercle.</p>
    <p>La zone pulse avant de changer de position, prépare-toi !</p>
    <p>Le jeu devient plus rapide avec le temps.</p>
    <button id="startBtn">Jouer</button>
  </div>
  <canvas id="game-canvas" width="800" height="300" style="display:none;"></canvas>

<script>
(() => {
  const canvas = document.getElementById('game-canvas');
  const ctx = canvas.getContext('2d');

  const startScreen = document.getElementById('startScreen');
  const startBtn = document.getElementById('startBtn');

  const WIDTH = canvas.width;
  const HEIGHT = canvas.height;

  const player = {
    x: WIDTH / 2,
    y: HEIGHT - 60,
    radius: 20,
    speed: 10
  };

  const zone = {
    x: WIDTH / 2,
    y: HEIGHT - 60,
    radius: 40,
    baseRadius: 40,
    pulseRadius: 60,
    pulseDuration: 60,  // frames
    pulseCount: 0,
    moving: false,
    targetX: WIDTH / 2,
    speed: 2
  };

  let keys = {};
  let score = 0;
  let gameSpeed = 2;
  let gameOver = false;

  function playSound(frequency, duration=0.1) {
    let audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    if(audioCtx.state === 'suspended') audioCtx.resume();
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.connect(gain);
    gain.connect(audioCtx.destination);
    osc.frequency.value = frequency;
    osc.start();
    gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);
    osc.stop(audioCtx.currentTime + duration);
  }

  function startGame() {
    player.x = WIDTH / 2;
    score = 0;
    gameSpeed = 2;
    gameOver = false;
    zone.x = WIDTH / 2;
    zone.pulseCount = 0;
    zone.moving = false;
    zone.speed = gameSpeed;
    startScreen.style.display = 'none';
    canvas.style.display = 'block';
    loop();
  }

  function update() {
    if(gameOver) return;

    // Player movement
    if(keys['ArrowLeft']) {
      player.x -= player.speed;
      if(player.x - player.radius < 0) player.x = player.radius;
    }
    if(keys['ArrowRight']) {
      player.x += player.speed;
      if(player.x + player.radius > WIDTH) player.x = WIDTH - player.radius;
    }

    // Zone pulse before moving
    if(!zone.moving) {
      zone.pulseCount++;
      if(zone.pulseCount >= zone.pulseDuration) {
        zone.moving = true;
        zone.pulseCount = 0;
        // Choisit nouvelle position targetX proche de la position actuelle
        const moveRange = 200;
        const minX = zone.radius;
        const maxX = WIDTH - zone.radius;
        let newX;
        do {
          newX = zone.x + (Math.random() * 2 - 1) * moveRange;
          newX = Math.min(Math.max(newX, minX), maxX);
        } while(Math.abs(newX - zone.x) < 50); // éviter déplacement trop petit
        zone.targetX = newX;
        zone.speed = gameSpeed;
      }
    } else {
      // Déplacement zone vers targetX
      if(Math.abs(zone.x - zone.targetX) < zone.speed) {
        zone.x = zone.targetX;
        zone.moving = false;
      } else {
        zone.x += (zone.targetX > zone.x ? 1 : -1) * zone.speed;
      }
    }

    // Augmente la vitesse progressivement
    gameSpeed += 0.001;
    zone.speed = gameSpeed;

    // Score basé sur le temps en frames (60fps)
    score += 1/60;

    // Collision cercle à cercle
    const dx = player.x - zone.x;
    const dy = player.y - zone.y;
    const dist = Math.sqrt(dx * dx + dy * dy);
    if(dist < player.radius + zone.radius) {
      gameOver = true;
      playSound(100, 0.5);
    }
  }

  function draw() {
    ctx.clearRect(0, 0, WIDTH, HEIGHT);

    // Draw zone with pulse effect
    ctx.save();
    ctx.shadowColor = '#ff0044';
    ctx.shadowBlur = 20;
    let currentRadius = zone.baseRadius;
    if(!zone.moving) {
      // pulse interpolation
      const pulseProgress = zone.pulseCount / zone.pulseDuration;
      const pulseRadius = zone.baseRadius + (zone.pulseRadius - zone.baseRadius) * (Math.sin(pulseProgress * Math.PI));
      currentRadius = pulseRadius;
    }
    ctx.fillStyle = '#ff0044';
    ctx.beginPath();
    ctx.arc(zone.x, zone.y, currentRadius, 0, Math.PI * 2);
    ctx.fill();
    ctx.restore();

    // Draw player
    ctx.save();
    ctx.fillStyle = '#00ffff';
    ctx.shadowColor = '#00ffff';
    ctx.shadowBlur = 20;
    ctx.beginPath();
    ctx.arc(player.x, player.y, player.radius, 0, Math.PI * 2);
    ctx.fill();
    ctx.restore();

    // Draw score
    ctx.fillStyle = '#00ffff';
    ctx.font = 'bold 24px monospace';
    ctx.shadowColor = '#00ffff';
    ctx.shadowBlur = 10;
    ctx.fillText(`Score: ${Math.floor(score)}`, 20, 40);

    if(gameOver) {
      ctx.fillStyle = '#ff0044';
      ctx.font = 'bold 48px monospace';
      ctx.fillText('Game Over!', WIDTH / 2 - 130, HEIGHT / 2);
      ctx.font = '24px monospace';
      ctx.fillText(`Score final : ${Math.floor(score)}`, WIDTH / 2 - 110, HEIGHT / 2 + 40);
      ctx.fillText('Recharge la page pour rejouer', WIDTH / 2 - 140, HEIGHT / 2 + 80);
    }
  }

  function loop() {
    update();
    draw();
    if(!gameOver) requestAnimationFrame(loop);
  }

  // Gestion des touches
  window.addEventListener('keydown', e => {
    if(e.key === 'ArrowLeft' || e.key === 'ArrowRight') {
      e.preventDefault();
      keys[e.key] = true;
    }
  });
  window.addEventListener('keyup', e => {
    if(e.key === 'ArrowLeft' || e.key === 'ArrowRight') {
      e.preventDefault();
      keys[e.key] = false;
    }
  });

  startBtn.addEventListener('click', () => {
    startGame();
  });
})();
</script>
</body>
</html>
